<!DOCTYPE html>
<html>
<head>
    <title>Google OAuth Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        button { padding: 10px 20px; font-size: 16px; margin: 10px 5px; cursor: pointer; }
        .oauth-url { background: #f8f9fa; padding: 15px; border-radius: 5px; word-break: break-all; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîß Google OAuth Configuration Test</h1>
    
    <div class="status success">
        <strong>‚úÖ OAuth URL Generated Successfully</strong><br>
        Your app is correctly generating the Google OAuth URL.
    </div>
    
    <div class="oauth-url">
        <strong>Generated OAuth URL:</strong><br>
        <code>https://accounts.google.com/oauth2/auth?client_id=622861962504-a2ob64p9ve0drgal7ncoujm58mmsitjr.apps.googleusercontent.com&redirect_uri=https%3A%2F%2Frowcloxlszwnowlggqon.supabase.co%2Ffunctions%2Fv1%2Fgoogle-oauth&response_type=code&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fadsense.readonly+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fanalytics.readonly+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fwebmasters.readonly&access_type=offline&prompt=consent</code>
    </div>

    <h2>üìã Configuration Checklist:</h2>
    <ul>
        <li>‚úÖ <strong>Client ID</strong>: 622861962504-a2ob64p9ve0drgal7ncoujm58mmsitjr.apps.googleusercontent.com</li>
        <li>‚úÖ <strong>Redirect URI</strong>: https://rowcloxlszwnowlggqon.supabase.co/functions/v1/google-oauth</li>
        <li>‚úÖ <strong>Scopes</strong>: AdSense, Analytics, Search Console (readonly)</li>
        <li>‚úÖ <strong>Edge Function</strong>: Deployed and active</li>
        <li>‚úÖ <strong>Database Config</strong>: OAuth credentials saved</li>
    </ul>

    <div class="status warning">
        <strong>‚ö†Ô∏è Next Step Required:</strong><br>
        Add the redirect URI to your Google Cloud Console OAuth client configuration to fix the 404 error.
    </div>

    <h2>üß™ Test OAuth Flow:</h2>
    <button onclick="testOAuth()">Test Google OAuth</button>
    <button onclick="testEdgeFunction()">Test Edge Function</button>
    
    <div id="testResults"></div>

    <h2>üîß Troubleshooting:</h2>
    <div class="status error">
        <strong>If you see 404 errors:</strong>
        <ol>
            <li>Go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console</a></li>
            <li>Find your OAuth 2.0 client ID</li>
            <li>Add this exact redirect URI: <code>https://rowcloxlszwnowlggqon.supabase.co/functions/v1/google-oauth</code></li>
            <li>Save the changes</li>
            <li>Test the OAuth flow again</li>
        </ol>
    </div>

    <script>
        function testOAuth() {
            const oauthUrl = 'https://accounts.google.com/oauth2/auth?client_id=622861962504-a2ob64p9ve0drgal7ncoujm58mmsitjr.apps.googleusercontent.com&redirect_uri=https%3A%2F%2Frowcloxlszwnowlggqon.supabase.co%2Ffunctions%2Fv1%2Fgoogle-oauth&response_type=code&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fadsense.readonly+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fanalytics.readonly+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fwebmasters.readonly&access_type=offline&prompt=consent';
            
            const popup = window.open(oauthUrl, 'oauth', 'width=500,height=600');
            
            // Listen for messages from the popup
            window.addEventListener('message', function(event) {
                if (event.data.type === 'oauth_success') {
                    document.getElementById('testResults').innerHTML = '<div class="status success">‚úÖ OAuth flow completed successfully!</div>';
                    popup.close();
                }
            });
            
            document.getElementById('testResults').innerHTML = '<div class="status warning">üîÑ OAuth popup opened. Complete the authorization flow...</div>';
        }

        function testEdgeFunction() {
            fetch('https://rowcloxlszwnowlggqon.supabase.co/functions/v1/google-oauth', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ action: 'check_status' })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('testResults').innerHTML = 
                    '<div class="status success">‚úÖ Edge function is responding: ' + JSON.stringify(data) + '</div>';
            })
            .catch(error => {
                document.getElementById('testResults').innerHTML = 
                    '<div class="status error">‚ùå Edge function error: ' + error.message + '</div>';
            });
        }
    </script>
</body>
</html>
